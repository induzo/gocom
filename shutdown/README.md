<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# shutdown

```go
import "github.com/induzo/gocom/shutdown"
```

This package allows you to gracefully shutdown your app.

## Index

- [type Hook](<#Hook>)
- [type HookOption](<#HookOption>)
  - [func Before\(before string\) HookOption](<#Before>)
- [type Option](<#Option>)
  - [func WithGracePeriodDuration\(gracePeriodDuration time.Duration\) Option](<#WithGracePeriodDuration>)
  - [func WithHooks\(hooks \[\]Hook\) Option](<#WithHooks>)
- [type Shutdown](<#Shutdown>)
  - [func New\(logger \*slog.Logger, opts ...Option\) \*Shutdown](<#New>)
  - [func \(s \*Shutdown\) Add\(name string, shutdownFunc func\(ctx context.Context\) error, hookOpts ...HookOption\)](<#Shutdown.Add>)
  - [func \(s \*Shutdown\) Hooks\(\) \[\]Hook](<#Shutdown.Hooks>)
  - [func \(s \*Shutdown\) Listen\(ctx context.Context, signals ...os.Signal\) error](<#Shutdown.Listen>)


<a name="Hook"></a>
## type [Hook](<https://github.com/induzo/gocom/blob/main/shutdown/shutdown.go#L18-L22>)

Hook is a shutdown hook that will be called when signal is received.

```go
type Hook struct {
    Name       string
    ShutdownFn func(ctx context.Context) error
    // contains filtered or unexported fields
}
```

<a name="HookOption"></a>
## type [HookOption](<https://github.com/induzo/gocom/blob/main/shutdown/shutdown.go#L76>)



```go
type HookOption func(*Hook)
```

<a name="Before"></a>
### func [Before](<https://github.com/induzo/gocom/blob/main/shutdown/shutdown.go#L78>)

```go
func Before(before string) HookOption
```



<a name="Option"></a>
## type [Option](<https://github.com/induzo/gocom/blob/main/shutdown/shutdown.go#L34>)

Option is the options type to configure Shutdown.

```go
type Option func(*Shutdown)
```

<a name="WithGracePeriodDuration"></a>
### func [WithGracePeriodDuration](<https://github.com/induzo/gocom/blob/main/shutdown/shutdown.go#L70>)

```go
func WithGracePeriodDuration(gracePeriodDuration time.Duration) Option
```

WithGracePeriodDuration sets the grace period for all shutdown hooks to finish running. If not used, the default grace period is 30s.

<a name="WithHooks"></a>
### func [WithHooks](<https://github.com/induzo/gocom/blob/main/shutdown/shutdown.go#L54>)

```go
func WithHooks(hooks []Hook) Option
```

WithHooks adds the hooks to be run as part of the graceful shutdown.

<a name="Shutdown"></a>
## type [Shutdown](<https://github.com/induzo/gocom/blob/main/shutdown/shutdown.go#L25-L31>)

Shutdown provides a way to listen for signals and handle shutdown of an application gracefully.

```go
type Shutdown struct {
    // contains filtered or unexported fields
}
```

<details><summary>Example</summary>
<p>



```go
package main

import (
	"context"
	"errors"
	"fmt"
	"io"
	"log"
	"log/slog"
	"net/http"
	"syscall"
	"time"

	"github.com/induzo/gocom/shutdown"
)

func main() {
	textHandler := slog.NewTextHandler(io.Discard, nil)
	logger := slog.New(textHandler)

	shutdownHandler := shutdown.New(
		logger,
		shutdown.WithHooks(
			[]shutdown.Hook{
				{
					Name: "do something",
					ShutdownFn: func(_ context.Context) error {
						return nil
					},
				},
			},
		),
		shutdown.WithGracePeriodDuration(time.Second))

	var srv http.Server

	go func() {
		if err := srv.ListenAndServe(); err != nil && !errors.Is(err, http.ErrServerClosed) {
			log.Fatalf("http server listen and serve: %s", err)
		}
	}()

	shutdownHandler.Add("http server", func(ctx context.Context) error {
		if err := srv.Shutdown(ctx); err != nil {
			return fmt.Errorf("http server shutdown: %w", err)
		}

		return nil
	})

	if err := shutdownHandler.Listen(
		context.Background(),
		syscall.SIGHUP,
		syscall.SIGINT,
		syscall.SIGTERM,
		syscall.SIGQUIT); err != nil {
		log.Fatalf("graceful shutdown failed: %s. forcing exit.", err)
	}
}
```

</p>
</details>

<a name="New"></a>
### func [New](<https://github.com/induzo/gocom/blob/main/shutdown/shutdown.go#L37>)

```go
func New(logger *slog.Logger, opts ...Option) *Shutdown
```

New returns a new Shutdown with the provided options.

<a name="Shutdown.Add"></a>
### func \(\*Shutdown\) [Add](<https://github.com/induzo/gocom/blob/main/shutdown/shutdown.go#L87>)

```go
func (s *Shutdown) Add(name string, shutdownFunc func(ctx context.Context) error, hookOpts ...HookOption)
```

Add adds a shutdown hook to be run when the signal is received.

<a name="Shutdown.Hooks"></a>
### func \(\*Shutdown\) [Hooks](<https://github.com/induzo/gocom/blob/main/shutdown/shutdown.go#L105>)

```go
func (s *Shutdown) Hooks() []Hook
```

Hooks returns a copy of the shutdown hooks, taking into account the before option

<a name="Shutdown.Listen"></a>
### func \(\*Shutdown\) [Listen](<https://github.com/induzo/gocom/blob/main/shutdown/shutdown.go#L183>)

```go
func (s *Shutdown) Listen(ctx context.Context, signals ...os.Signal) error
```

Listen waits for the signals provided and executes each shutdown hook sequentially in FILO order. It will immediately stop and return once the grace period has passed.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
