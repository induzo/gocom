<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# pginit

```go
import "github.com/induzo/gocom/database/pginit/v2"
```

This package allows you to init a connection pool to postgres database via pgx

## Index

- [func ConnPoolHealthCheck(pool *pgxpool.Pool) func(ctx context.Context) error](<#func-connpoolhealthcheck>)
- [func JSONRowToAddrOfStruct[T any](row pgx.CollectableRow) (*T, error)](<#func-jsonrowtoaddrofstruct>)
- [type Option](<#type-option>)
  - [func WithDecimalType() Option](<#func-withdecimaltype>)
  - [func WithLogger(logger *slog.Logger, _ string) Option](<#func-withlogger>)
  - [func WithTracer(opts ...otelpgx.Option) Option](<#func-withtracer>)
  - [func WithUUIDType() Option](<#func-withuuidtype>)
- [type PGInit](<#type-pginit>)
  - [func New(connString string, opts ...Option) (*PGInit, error)](<#func-new>)
  - [func (pgi *PGInit) ConnPool(ctx context.Context) (*pgxpool.Pool, error)](<#func-pginit-connpool>)


## func ConnPoolHealthCheck

```go
func ConnPoolHealthCheck(pool *pgxpool.Pool) func(ctx context.Context) error
```

ConnPoolHealthCheck returns a health check function for pgxpool.Pool that can be used in health endpoint.

<details><summary>Example</summary>
<p>

Using standard net/http package. We can also simply pass healthCheck as a CheckFn in gocom/http/health/v2.

```go
{
	pgi, err := pginit.New("postgres://postgres:postgres@localhost:5432/datawarehouse?sslmode=disable&pool_max_conns=10&pool_max_conn_lifetime=1m")
	if err != nil {
		log.Fatalf("init pgi config: %v", err)
	}

	ctx := context.Background()

	pool, err := pgi.ConnPool(ctx)
	if err != nil {
		log.Fatalf("init pgi config: %v", err)
	}

	defer pool.Close()

	healthCheck := pginit.ConnPoolHealthCheck(pool)

	mux := http.NewServeMux()

	mux.HandleFunc("/sys/health", func(rw http.ResponseWriter, req *http.Request) {
		if err := healthCheck(ctx); err != nil {
			rw.WriteHeader(http.StatusServiceUnavailable)
		}
	})
}
```

</p>
</details>

## func JSONRowToAddrOfStruct

```go
func JSONRowToAddrOfStruct[T any](row pgx.CollectableRow) (*T, error)
```

## type Option

Option configures PGInit behaviour.

```go
type Option func(*PGInit)
```

### func WithDecimalType

```go
func WithDecimalType() Option
```

WithDecimalType set pgx decimal type to shopspring/decimal.

### func WithLogger

```go
func WithLogger(logger *slog.Logger, _ string) Option
```

WithLogger Add logger to pgx. if the request context contains request id, can pass in the request id context key to reqIDKeyFromCtx and logger will log with the request id.

### func WithTracer

```go
func WithTracer(opts ...otelpgx.Option) Option
```

WithTracer Add tracer to pgx.

### func WithUUIDType

```go
func WithUUIDType() Option
```

WithUUIDType set pgx uuid type to gofrs/uuid.

## type PGInit

PGInit provides capabilities for connect to postgres with pgx.pool.

```go
type PGInit struct {
    // contains filtered or unexported fields
}
```

### func New

```go
func New(connString string, opts ...Option) (*PGInit, error)
```

New initializes a PGInit using the provided Config and options. If opts is not provided it will initializes PGInit with default configuration.

### func \(\*PGInit\) ConnPool

```go
func (pgi *PGInit) ConnPool(ctx context.Context) (*pgxpool.Pool, error)
```

ConnPool initiates connection to database and return a pgxpool.Pool.

<details><summary>Example</summary>
<p>

```go
{
	pgi, err := pginit.New("postgres://postgres:postgres@localhost:5432/datawarehouse?sslmode=disable&pool_max_conns=10&pool_max_conn_lifetime=1m")
	if err != nil {
		log.Fatalf("init pgi config: %v", err)
	}

	ctx := context.Background()

	pool, err := pgi.ConnPool(ctx)
	if err != nil {
		log.Fatalf("init pgi config: %v", err)
	}

	defer pool.Close()

	if err := pool.Ping(ctx); err != nil {
		log.Fatalf("ping: %v", err)
	}
}
```

</p>
</details>

<details><summary>Example (Withlogger)</summary>
<p>

```go
{
	textHandler := slog.NewTextHandler(io.Discard, nil)
	logger := slog.New(textHandler)

	pgi, err := pginit.New(
		"postgres://postgres:postgres@localhost:5432/datawarehouse?sslmode=disable&pool_max_conns=10&pool_max_conn_lifetime=1m",
		pginit.WithLogger(logger, "request-id"),
		pginit.WithDecimalType(),
		pginit.WithUUIDType(),
	)
	if err != nil {
		log.Fatalf("init pgi config: %v", err)
	}

	ctx := context.Background()

	pool, err := pgi.ConnPool(ctx)
	if err != nil {
		log.Fatalf("init pgi config: %v", err)
	}

	defer pool.Close()

	if err := pool.Ping(ctx); err != nil {
		log.Fatalf("ping: %v", err)
	}
}
```

</p>
</details>



Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
