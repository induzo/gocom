<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# pginit

```go
import "github.com/induzo/gocom/database/pginit"
```

This package allows you to init a connection pool to postgres database via pgx below are default value in pginit:

default MaxConns = 25

default MaxIdleConns = 25

default MaxLifeTime = 5 minute

default LogLevel = Warn

## Index

- [func ConnPoolHealthCheck(pool \*pgxpool.Pool) func(ctx context.Context) error](#func-connpoolhealthcheck)
- [func StdConnHealthCheck(conn \*sql.DB) func(ctx context.Context) error](#func-stdconnhealthcheck)
- [type Config](#type-config)
- [type Option](#type-option)
  - [func WithDecimalType() Option](#func-withdecimaltype)
  - [func WithLogger(logger \*slog.Logger, \_ string) Option](#func-withlogger)
  - [func WithUUIDType() Option](#func-withuuidtype)
- [type PGInit](#type-pginit)
  - [func New(conf *Config, opts ...Option) (*PGInit, error)](#func-new)
  - [func (pgi *PGInit) ConnPool(ctx context.Context) (*pgxpool.Pool, error)](#func-pginit-connpool)

## func ConnPoolHealthCheck

```go
func ConnPoolHealthCheck(pool *pgxpool.Pool) func(ctx context.Context) error
```

ConnPoolHealthCheck returns a health check function for pgxpool.Pool that can be used in health endpoint.

<details><summary>Example</summary>
<p>

Using standard net/http package. We can also simply pass healthCheck as a CheckFn in gocom/http/health/v2.

```go
package main

import (
	"context"
	"log"
	"net/http"
	"time"

	"github.com/induzo/gocom/database/pginit"
)

func main() {
	pgi, err := pginit.New(&pginit.Config{
		Host:         "localhost",
		Port:         "5432",
		User:         "postgres",
		Password:     "postgres",
		Database:     "datawarehouse",
		MaxConns:     10,
		MaxIdleConns: 10,
		MaxLifeTime:  1 * time.Minute,
	})
	if err != nil {
		log.Fatalf("init pgi config: %v", err)
	}

	ctx := context.Background()

	pool, err := pgi.ConnPool(ctx)
	if err != nil {
		log.Fatalf("init pgi config: %v", err)
	}

	defer pool.Close()

	healthCheck := pginit.ConnPoolHealthCheck(pool)

	mux := http.NewServeMux()

	mux.HandleFunc("/sys/health", func(rw http.ResponseWriter, req *http.Request) {
		if err := healthCheck(ctx); err != nil {
			rw.WriteHeader(http.StatusServiceUnavailable)
		}
	})
}
```

</p>
</details>

## func StdConnHealthCheck

```go
func StdConnHealthCheck(conn *sql.DB) func(ctx context.Context) error
```

StdConnHealthCheck returns a health check function for sql.DB that can be used in health endpoint.

## type Config

Config allow you to set database credential to connect to database

```go
type Config struct {
    User         string
    Password     string
    Host         string
    Port         string
    Database     string
    MaxConns     int32
    MaxIdleConns int32
    MaxLifeTime  time.Duration
}
```

## type Option

Option configures PGInit behaviour.

```go
type Option func(*PGInit)
```

### func WithDecimalType

```go
func WithDecimalType() Option
```

WithDecimalType set pgx decimal type to shopspring/decimal.

### func WithLogger

```go
func WithLogger(logger *slog.Logger, _ string) Option
```

WithLogger Add logger to pgx. if the request context contains request id, can pass in the request id context key to reqIDKeyFromCtx and logger will log with the request id.

### func WithUUIDType

```go
func WithUUIDType() Option
```

WithUUIDType set pgx uuid type to gofrs/uuid.

## type PGInit

PGInit provides capabilities for connect to postgres with pgx.pool.

```go
type PGInit struct {
    // contains filtered or unexported fields
}
```

### func New

```go
func New(conf *Config, opts ...Option) (*PGInit, error)
```

New initializes a PGInit using the provided Config and options. If opts is not provided it will initializes PGInit with default configuration.

### func \(\*PGInit\) ConnPool

```go
func (pgi *PGInit) ConnPool(ctx context.Context) (*pgxpool.Pool, error)
```

ConnPool initiates connection to database and return a pgxpool.Pool.

<details><summary>Example</summary>
<p>

```go
package main

import (
	"context"
	"log"
	"time"

	"github.com/induzo/gocom/database/pginit"
)

func main() {
	pgi, err := pginit.New(&pginit.Config{
		Host:         "localhost",
		Port:         "5432",
		User:         "postgres",
		Password:     "postgres",
		Database:     "datawarehouse",
		MaxConns:     10,
		MaxIdleConns: 10,
		MaxLifeTime:  1 * time.Minute,
	})
	if err != nil {
		log.Fatalf("init pgi config: %v", err)
	}

	ctx := context.Background()

	pool, err := pgi.ConnPool(ctx)
	if err != nil {
		log.Fatalf("init pgi config: %v", err)
	}

	defer pool.Close()

	if err := pool.Ping(ctx); err != nil {
		log.Fatalf("ping: %v", err)
	}
}
```

</p>
</details>

<details><summary>Example (Withlogger)</summary>
<p>

```go
package main

import (
	"context"
	"io"
	"log"
	"time"

	"golang.org/x/exp/slog"

	"github.com/induzo/gocom/database/pginit"
)

func main() {
	textHandler := slog.NewTextHandler(io.Discard)
	logger := slog.New(textHandler)

	pgi, err := pginit.New(
		&pginit.Config{
			Host:         "localhost",
			Port:         "5432",
			User:         "postgres",
			Password:     "postgres",
			Database:     "datawarehouse",
			MaxConns:     10,
			MaxIdleConns: 10,
			MaxLifeTime:  1 * time.Minute,
		},
		pginit.WithLogger(logger, "request-id"),
		pginit.WithDecimalType(),
		pginit.WithUUIDType(),
	)
	if err != nil {
		log.Fatalf("init pgi config: %v", err)
	}

	ctx := context.Background()

	pool, err := pgi.ConnPool(ctx)
	if err != nil {
		log.Fatalf("init pgi config: %v", err)
	}

	defer pool.Close()

	if err := pool.Ping(ctx); err != nil {
		log.Fatalf("ping: %v", err)
	}
}
```

</p>
</details>

Generated by [gomarkdoc](https://github.com/princjef/gomarkdoc)
