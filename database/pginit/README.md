<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# pginit

```go
import "github.com/induzo/gocom/database/pginit/v2"
```

This package allows you to init a connection pool to postgres database via pgx

## Index

- [func ConnPoolHealthCheck\(pool \*pgxpool.Pool\) func\(ctx context.Context\) error](<#ConnPoolHealthCheck>)
- [func JSONRowToAddrOfStruct\[T any\]\(row pgx.CollectableRow\) \(\*T, error\)](<#JSONRowToAddrOfStruct>)
- [type Option](<#Option>)
  - [func WithDecimalType\(\) Option](<#WithDecimalType>)
  - [func WithGoogleUUIDType\(\) Option](<#WithGoogleUUIDType>)
  - [func WithLogger\(logger \*slog.Logger, \_ string\) Option](<#WithLogger>)
  - [func WithTracer\(opts ...otelpgx.Option\) Option](<#WithTracer>)
  - [func WithUUIDType\(\) Option](<#WithUUIDType>)
- [type PGInit](<#PGInit>)
  - [func New\(connString string, opts ...Option\) \(\*PGInit, error\)](<#New>)
  - [func \(pgi \*PGInit\) ConnPool\(ctx context.Context\) \(\*pgxpool.Pool, error\)](<#PGInit.ConnPool>)


<a name="ConnPoolHealthCheck"></a>
## func [ConnPoolHealthCheck](<https://github.com/induzo/gocom/blob/main/database/pginit/healthcheck.go#L10>)

```go
func ConnPoolHealthCheck(pool *pgxpool.Pool) func(ctx context.Context) error
```

ConnPoolHealthCheck returns a health check function for pgxpool.Pool that can be used in health endpoint.

<details><summary>Example</summary>
<p>

Using standard net/http package. We can also simply pass healthCheck as a CheckFn in gocom/http/health/v2.

```go
pgi, err := pginit.New("postgres://postgres:postgres@localhost:5432/datawarehouse?sslmode=disable&pool_max_conns=10&pool_max_conn_lifetime=1m")
if err != nil {
	log.Fatalf("init pgi config: %v", err)
}

ctx := context.Background()

pool, err := pgi.ConnPool(ctx)
if err != nil {
	log.Fatalf("init pgi config: %v", err)
}

defer pool.Close()

healthCheck := pginit.ConnPoolHealthCheck(pool)

mux := http.NewServeMux()

mux.HandleFunc("/sys/health", func(rw http.ResponseWriter, _ *http.Request) {
	if err := healthCheck(ctx); err != nil {
		rw.WriteHeader(http.StatusServiceUnavailable)
	}
})
```

</p>
</details>

<a name="JSONRowToAddrOfStruct"></a>
## func [JSONRowToAddrOfStruct](<https://github.com/induzo/gocom/blob/main/database/pginit/jsonrow.go#L10>)

```go
func JSONRowToAddrOfStruct[T any](row pgx.CollectableRow) (*T, error)
```



<a name="Option"></a>
## type [Option](<https://github.com/induzo/gocom/blob/main/database/pginit/pool.go#L21>)

Option configures PGInit behaviour.

```go
type Option func(*PGInit)
```

<a name="WithDecimalType"></a>
### func [WithDecimalType](<https://github.com/induzo/gocom/blob/main/database/pginit/pool.go#L92>)

```go
func WithDecimalType() Option
```

WithDecimalType set pgx decimal type to shopspring/decimal.

<a name="WithGoogleUUIDType"></a>
### func [WithGoogleUUIDType](<https://github.com/induzo/gocom/blob/main/database/pginit/pool.go#L106>)

```go
func WithGoogleUUIDType() Option
```

WithGoogleUUIDType set pgx uuid type to google/uuid.

<a name="WithLogger"></a>
### func [WithLogger](<https://github.com/induzo/gocom/blob/main/database/pginit/pool.go#L75>)

```go
func WithLogger(logger *slog.Logger, _ string) Option
```

WithLogger Add logger to pgx. if the request context contains request id, can pass in the request id context key to reqIDKeyFromCtx and logger will log with the request id.

<a name="WithTracer"></a>
### func [WithTracer](<https://github.com/induzo/gocom/blob/main/database/pginit/pool.go#L85>)

```go
func WithTracer(opts ...otelpgx.Option) Option
```

WithTracer Add tracer to pgx.

<a name="WithUUIDType"></a>
### func [WithUUIDType](<https://github.com/induzo/gocom/blob/main/database/pginit/pool.go#L99>)

```go
func WithUUIDType() Option
```

WithUUIDType set pgx uuid type to gofrs/uuid.

<a name="PGInit"></a>
## type [PGInit](<https://github.com/induzo/gocom/blob/main/database/pginit/pool.go#L24-L27>)

PGInit provides capabilities for connect to postgres with pgx.pool.

```go
type PGInit struct {
    // contains filtered or unexported fields
}
```

<a name="New"></a>
### func [New](<https://github.com/induzo/gocom/blob/main/database/pginit/pool.go#L31>)

```go
func New(connString string, opts ...Option) (*PGInit, error)
```

New initializes a PGInit using the provided Config and options. If opts is not provided it will initializes PGInit with default configuration.

<a name="PGInit.ConnPool"></a>
### func \(\*PGInit\) [ConnPool](<https://github.com/induzo/gocom/blob/main/database/pginit/pool.go#L57>)

```go
func (pgi *PGInit) ConnPool(ctx context.Context) (*pgxpool.Pool, error)
```

ConnPool initiates connection to database and return a pgxpool.Pool.

<details><summary>Example</summary>
<p>



```go
pgi, err := pginit.New("postgres://postgres:postgres@localhost:5432/datawarehouse?sslmode=disable&pool_max_conns=10&pool_max_conn_lifetime=1m")
if err != nil {
	log.Fatalf("init pgi config: %v", err)
}

ctx := context.Background()

pool, err := pgi.ConnPool(ctx)
if err != nil {
	log.Fatalf("init pgi config: %v", err)
}

defer pool.Close()

if err := pool.Ping(ctx); err != nil {
	log.Fatalf("ping: %v", err)
}
```

</p>
</details>

<details><summary>Example (Withlogger)</summary>
<p>



```go
textHandler := slog.NewTextHandler(io.Discard, nil)
logger := slog.New(textHandler)

pgi, err := pginit.New(
	"postgres://postgres:postgres@localhost:5432/datawarehouse?sslmode=disable&pool_max_conns=10&pool_max_conn_lifetime=1m",
	pginit.WithLogger(logger, "request-id"),
	pginit.WithDecimalType(),
	pginit.WithUUIDType(),
)
if err != nil {
	log.Fatalf("init pgi config: %v", err)
}

ctx := context.Background()

pool, err := pgi.ConnPool(ctx)
if err != nil {
	log.Fatalf("init pgi config: %v", err)
}

defer pool.Close()

if err := pool.Ping(ctx); err != nil {
	log.Fatalf("ping: %v", err)
}
```

</p>
</details>

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
